<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Hello, World</title>
<style type="text/css">
html {
	height: 100%
}

body {
	height: 100%;
	margin: 0px;
	padding: 0px
}

#container {
	height: 100%
}
</style>
<script type="text/javascript"
	src="http://api.map.baidu.com/api?v=2.0&ak=vebrtBN0wNUBTDMPjmFczgUR7fWpoPFg">
	//v2.0版本的引用方式：src="http://api.map.baidu.com/api?v=2.0&ak=您的密钥"
</script>
</head>

<body>
	<div id="container"></div>
	<script type="text/javascript">
		// 创建地图实例  34.5803659378,112.5574236552
		var map = new BMap.Map("container");
		// 创建点坐标  
		var point = new BMap.Point(112.559131,34.581693);
		// 初始化地图，设置中心点坐标和地图级别
		map.centerAndZoom(point, 17);
		map.addControl(new BMap.NavigationControl());
		map.addControl(new BMap.NavigationControl());    
		map.addControl(new BMap.ScaleControl());    
		map.addControl(new BMap.OverviewMapControl());    
		map.addControl(new BMap.MapTypeControl());    
		map.setCurrentCity("洛阳");
		map.enableScrollWheelZoom(true);//开启鼠标滚轮缩放
		
	
		 //1、定义构造函数并继承Overlay
		　　//定义自定义覆盖物的构造函数  
		    function ComplexCustomOverlay(point){
		      this._point = point;
		      
		    }
		　　 // 继承API的BMap.Overlay  
		    ComplexCustomOverlay.prototype = new BMap.Overlay();
		    //2、初始化自定义覆盖物
		    // 实现初始化方法  
		    ComplexCustomOverlay.prototype.initialize = function(map){
		      // 保存map对象实例 
		      this._map = map;
		      // 创建div元素，作为自定义覆盖物的容器  
		      var div = this._div = document.createElement("div");
		      div.style.position = "absolute";
		      div.style.zIndex = BMap.Overlay.getZIndex(this._point.lat);//聚合功能?
		      // 可以根据参数设置元素外观
		      div.style.height = "500px";
		      div.style.width="500px";

		      var arrow = this._arrow = document.createElement("img");
		      arrow.src = "dzc.jpg";
		      arrow.style.width = "500px";
		      arrow.style.height = "500px";
		      arrow.style.top = "-100px";
		      arrow.style.left = "10px";
		      div.appendChild(arrow);
		     
		　    // 将div添加到覆盖物容器中  
		      map.getPanes().labelPane.appendChild(div);//getPanes(),返回值:MapPane,返回地图覆盖物容器列表  labelPane呢???
		      // 需要将div元素作为方法的返回值，当调用该覆盖物的show、  
		      // hide方法，或者对覆盖物进行移除时，API都将操作此元素。
		      return div;
		      
		    }
		    
		    //3、绘制覆盖物
		    // 实现绘制方法
		    ComplexCustomOverlay.prototype.draw = function(){
		      var map = this._map;
		      var pixel = map.pointToOverlayPixel(this._point);
		      this._div.style.left = pixel.x - parseInt(this._arrow.style.left) + "px";
		      this._div.style.top  = pixel.y - 30 + "px";
		    }
		        
		   
		    //4、自定义覆盖物添加事件方法
		    ComplexCustomOverlay.prototype.addEventListener = function(event,fun){
		        this._div['on'+event] = fun;
		    }

		    
		    var myCompOverlay = new ComplexCustomOverlay(new BMap.Point(112.555861,34.581522));
		    map.addOverlay(myCompOverlay);//将标注添加到地图中
		    

		    //5、 为自定义覆盖物添加点击事件
		    myCompOverlay.addEventListener('click',function(){
		        //alert("点击图标");
		        //hide_show();
		    });

		    var show=0; 

		    function hide_show(){ 

		        if(show==0){ 
		            myCompOverlay.hide(); 
		            show=1; 
		        }else{ 
		            myCompOverlay.show(); 
		            show=0; 
		        } 
		    } 
		    
	
		    
		    //进行浏览器定位
		    var geolocation = new BMap.Geolocation();
		    geolocation.getCurrentPosition(function(r){
			    // 定位成功事件
			    if(this.getStatus() == BMAP_STATUS_SUCCESS){
				    //alert('您的位置：'+r.point.lng+','+r.point.lat);
				    var point = new BMap.Point(r.point.lng, +r.point.lat);
			    }
		    },{
		    	enableHighAccuracy: true
		    })
		    //addEventListener--添加事件监听函数
		    var lng = "";
		    var lat = "";
			map.addEventListener("click",function(e){
				lng = e.point.lng;
				lat = e.point.lat;
				prompt("鼠标单击地方的经纬度为：",e.point.lng + "," + e.point.lat);
			});
		    var myP1 = new BMap.Point(112.56011,34.58176);    //起点
			var myP2 = new BMap.Point(112.560757,34.578149);    //终点
			
			var scrollFunc=function(e){
			     e=e || window.event;
			     var t1=document.getElementById("mapInfo");
			         t1.value=map.getZoom();
			 }
			 /*注册事件*/
			 if(document.addEventListener){
			     document.addEventListener('DOMMouseScroll',scrollFunc,false);
			 }//W3C
			 window.onmousewheel=document.onmousewheel=scrollFunc;//IE/Opera/Chrome

			

// 		    map.clearOverlays();                        //清除地图上所有的覆盖物
// 		    var walking = new BMap.WalkingRoute(map);    //创建驾车实例
// 		    walking.search(myP1, myP2);                 //第一个驾车搜索
// 		    walking.setSearchCompleteCallback(function(){
// 		        var pts = walking.getResults().getPlan(0).getRoute(0).getPath();    //通过驾车实例，获得一系列点的数组       
// 		        var polyline = new BMap.Polyline(pts);            
// 		        map.addOverlay(polyline);               
// 		        var m1 = new BMap.Marker(myP1);         //创建marker        
// 		        var m2 = new BMap.Marker(myP2);        
// 		        map.addOverlay(m1);        
// 		        map.addOverlay(m2);        
// 		        var lab1 = new BMap.Label("起点",{position:myP1});        //创建label
// 		        var lab2 = new BMap.Label("终点",{position:myP2});       
// 		        map.addOverlay(lab1);        
// 		        map.addOverlay(lab2);        
// 		        setTimeout(function(){           
// 		        		map.setViewport([myP1,myP2]);          //调整到最佳视野        
// 		        	},1000);            
// 		        }
// 		    );
	</script>
</body>
</html>